# üöÄ ZALIZO.STUDIO - –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Nginx –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

server {
    listen 80;
    server_name zalizo.studio www.zalizo.studio;
    
    # –ü–µ—Ä–µ—Å–ø—Ä—è–º—É–≤–∞–Ω–Ω—è –Ω–∞ HTTPS (—è–∫—â–æ —î SSL)
    # return 301 https://$server_name$request_uri;
    
    root /var/www/zalizo;
    index index.html;
    
    # ============================================
    # –ó–ê–ì–ê–õ–¨–ù–Ü –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø
    # ============================================
    
    charset utf-8;
    
    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    client_max_body_size 50M;
    
    # ============================================
    # GZIP –°–¢–ò–°–ù–ï–ù–ù–Ø
    # ============================================
    
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/json
        application/javascript
        application/x-javascript
        application/xml
        application/xml+rss
        application/xhtml+xml
        application/rss+xml
        application/atom+xml
        image/svg+xml
        font/woff2
        font/woff;
    gzip_min_length 1000;
    gzip_disable "msie6";
    
    # ============================================
    # BROTLI –°–¢–ò–°–ù–ï–ù–ù–Ø (—è–∫—â–æ –º–æ–¥—É–ª—å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)
    # ============================================
    
    # brotli on;
    # brotli_comp_level 6;
    # brotli_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript image/svg+xml;
    
    # ============================================
    # –ö–ï–®–£–í–ê–ù–ù–Ø –°–¢–ê–¢–ò–ß–ù–ò–• –†–ï–°–£–†–°–Ü–í
    # ============================================
    
    # –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥–µ–æ - 1 —Ä—ñ–∫
    location ~* \.(jpg|jpeg|png|gif|webp|svg|ico|mp4|webm)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
        log_not_found off;
    }
    
    # –®—Ä–∏—Ñ—Ç–∏ - 1 —Ä—ñ–∫
    location ~* \.(woff2|woff|eot|ttf|otf)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        add_header Access-Control-Allow-Origin "*";
        access_log off;
        log_not_found off;
    }
    
    # CSS —Ç–∞ JavaScript - 1 –º—ñ—Å—è—Ü—å
    location ~* \.(css|js)$ {
        expires 30d;
        add_header Cache-Control "public";
        access_log off;
    }
    
    # HTML - 1 –≥–æ–¥–∏–Ω–∞
    location ~* \.(html|htm)$ {
        expires 1h;
        add_header Cache-Control "public, must-revalidate";
    }
    
    # ============================================
    # –ë–ï–ó–ü–ï–ö–ê
    # ============================================
    
    # –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–ø–µ–∫–∏
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;
    
    # –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ backup —Ñ–∞–π–ª—ñ–≤
    location ~ ~$ {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # ============================================
    # –û–°–ù–û–í–ù–ê –õ–û–ö–ê–¶–Ü–Ø
    # ============================================
    
    location / {
        try_files $uri $uri/ /index.html;
        
        # HTTP/2 Server Push (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
        # http2_push /css/main.css;
        # http2_push /js/main.js;
    }
    
    # ============================================
    # –í–Ü–î–ï–û - RANGE –ó–ê–ü–ò–¢–ò
    # ============================================
    
    location ~* \.(mp4|webm)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        add_header Accept-Ranges bytes;
        access_log off;
        
        # –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ range –∑–∞–ø–∏—Ç—ñ–≤ –¥–ª—è –≤—ñ–¥–µ–æ
        if ($request_method = 'OPTIONS') {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, OPTIONS";
            add_header Access-Control-Allow-Headers "Range";
            return 204;
        }
    }
    
    # ============================================
    # FAVICON
    # ============================================
    
    location = /favicon.ico {
        access_log off;
        log_not_found off;
        expires 1y;
    }
    
    location = /robots.txt {
        access_log off;
        log_not_found off;
    }
    
    # ============================================
    # ERROR PAGES
    # ============================================
    
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    # ============================================
    # –õ–û–ì–£–í–ê–ù–ù–Ø
    # ============================================
    
    access_log /var/log/nginx/zalizo-access.log combined buffer=32k flush=5m;
    error_log /var/log/nginx/zalizo-error.log warn;
}

# ============================================
# HTTPS –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø (—è–∫—â–æ —î SSL)
# ============================================

# server {
#     listen 443 ssl http2;
#     server_name zalizo.studio www.zalizo.studio;
#     
#     root /var/www/zalizo;
#     index index.html;
#     
#     # SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏
#     ssl_certificate /etc/letsencrypt/live/zalizo.studio/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/zalizo.studio/privkey.pem;
#     
#     # SSL –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384';
#     ssl_prefer_server_ciphers off;
#     ssl_session_cache shared:SSL:10m;
#     ssl_session_timeout 10m;
#     ssl_stapling on;
#     ssl_stapling_verify on;
#     
#     # HSTS (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, –ø—ñ—Å–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)
#     # add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
#     
#     # –†–µ—à—Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —è–∫ —É HTTP –±–ª–æ—Ü—ñ –≤–∏—â–µ
#     # ...
# }
